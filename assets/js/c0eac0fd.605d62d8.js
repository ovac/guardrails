"use strict";(self.webpackChunkguardrails_docs=self.webpackChunkguardrails_docs||[]).push([[2035],{9728:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"signing-policy","title":"signing-policy","description":"title: Signing Policy Reference","source":"@site/versioned_docs/version-1.0.0/signing-policy.md","sourceDirName":".","slug":"/signing-policy","permalink":"/guardrails/docs/signing-policy","draft":false,"unlisted":false,"editUrl":"https://github.com/ovac/guardrails/edit/main/resources/docs/versioned_docs/version-1.0.0/signing-policy.md","tags":[],"version":"1.0.0","frontMatter":{},"sidebar":"docs","previous":{"title":"Flows and Policies","permalink":"/guardrails/docs/flows-and-policies"},"next":{"title":"Permissions & Policies","permalink":"/guardrails/docs/permissions"}}');var r=i(74848),l=i(28453);const o={},a="Signing Policy Reference",t={},c=[{value:"Permission checks",id:"permission-checks",level:2},{value:"Role checks",id:"role-checks",level:2},{value:"Initiator overlap",id:"initiator-overlap",level:2},{value:"Tokens and abilities",id:"tokens-and-abilities",level:2},{value:"Guard selection &amp; per-step overrides",id:"guard-selection--per-step-overrides",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Related configuration",id:"related-configuration",level:2}];function d(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"title: Signing Policy Reference\ndescription: How Guardrails evaluates permissions, roles, and custom resolvers."}),"\n",(0,r.jsx)(s.p,{children:"tags:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"approvals"}),"\n",(0,r.jsx)(s.li,{children:"signing"}),"\n",(0,r.jsx)(s.li,{children:"permissions"}),"\n",(0,r.jsx)(s.li,{children:"roles"}),"\n"]}),"\n",(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"signing-policy-reference",children:"Signing Policy Reference"})}),"\n",(0,r.jsx)(s.p,{children:"Guardrails relies on a signing policy to decide whether an authenticated initiator can approve a step. The evaluation order is predictable so you can design flows with confidence."}),"\n",(0,r.jsx)(s.h2,{id:"permission-checks",children:"Permission checks"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Permissions come first."})," The signer rules list ",(0,r.jsx)(s.code,{children:"permissions"})," plus a ",(0,r.jsx)(s.code,{children:"permissions_mode"})," (",(0,r.jsx)(s.code,{children:"all"})," or ",(0,r.jsx)(s.code,{children:"any"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:["Guardrails looks for permission helpers on the user:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["If the user exposes Spatie-style methods (",(0,r.jsx)(s.code,{children:"hasPermissionTo"}),"), those are used."]}),"\n",(0,r.jsxs)(s.li,{children:["Otherwise, Guardrails inspects token abilities (e.g. ",(0,r.jsx)(s.code,{children:"currentAccessToken()->abilities"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["For ",(0,r.jsx)(s.code,{children:"all"}),", the initiator must satisfy every listed permission. For ",(0,r.jsx)(s.code,{children:"any"}),", a single match is enough."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Permissions work out of the box\u2014no extra configuration required."}),"\n",(0,r.jsx)(s.h2,{id:"role-checks",children:"Role checks"}),"\n",(0,r.jsx)(s.p,{children:"Roles are optional. If you include them in a step:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["With Spatie roles available (",(0,r.jsx)(s.code,{children:"hasRole"}),"), Guardrails uses the package directly."]}),"\n",(0,r.jsxs)(s.li,{children:["Without Spatie, Guardrails falls back to a resolver:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["By default, it inspects common patterns (an Eloquent relationship or ",(0,r.jsx)(s.code,{children:"roles"})," attribute)."]}),"\n",(0,r.jsxs)(s.li,{children:["You can take full control via the ",(0,r.jsx)(s.code,{children:"guardrails.signing.resolve_roles_using"})," config key. Set it to a closure that receives the authenticated user and returns an array of role identifiers."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",children:"// config/guardrails.php\n'signing' => [\n    'resolve_roles_using' => static function ($user) {\n        return $user->teams->pluck('slug')->all();\n    },\n],\n"})}),"\n",(0,r.jsx)(s.h2,{id:"initiator-overlap",children:"Initiator overlap"}),"\n",(0,r.jsxs)(s.p,{children:["Flows can demand overlap with the initiator using ",(0,r.jsx)(s.code,{children:"same_permission_as_initiator"})," or ",(0,r.jsx)(s.code,{children:"same_role_as_initiator"}),". Guardrails compares the initiator\u2019s permissions or roles against the signer\u2019s set after running the checks above. If no overlap exists, the signer is rejected."]}),"\n",(0,r.jsx)(s.h2,{id:"tokens-and-abilities",children:"Tokens and abilities"}),"\n",(0,r.jsx)(s.p,{children:"When using Laravel Sanctum or similar token guards, Guardrails will treat token abilities as permissions. Make sure the token includes the required ability names."}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["Guardrails uses the configured auth guard (default: ",(0,r.jsx)(s.code,{children:"auth.defaults.guard"}),"). You can change it via ",(0,r.jsx)(s.code,{children:"GUARDRAILS_AUTH_GUARD"})," or ",(0,r.jsx)(s.code,{children:"config/guardrails.php"}),". The helper ",(0,r.jsx)(s.code,{children:"OVAC\\Guardrails\\Support\\Auth"})," exposes ",(0,r.jsx)(s.code,{children:"guardName()"}),", ",(0,r.jsx)(s.code,{children:"guard()"}),", and ",(0,r.jsx)(s.code,{children:"user()"})," if you need to mirror Guardrails\u2019 guard selection in custom code."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"guard-selection--per-step-overrides",children:"Guard selection & per-step overrides"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"Flow::make()"})," seeds the guard from ",(0,r.jsx)(s.code,{children:"config('guardrails.auth.guard')"}),", falling back to your app\u2019s default guard. This keeps flows aligned with how you authenticate reviewers."]}),"\n",(0,r.jsxs)(s.li,{children:["You can override the guard for a specific step by chaining ",(0,r.jsx)(s.code,{children:"guard('other-guard')"})," before calling ",(0,r.jsx)(s.code,{children:"signedBy()"}),". See the ",(0,r.jsx)(s.a,{href:"/guardrails/docs/usage-controllers#mixing-guards-in-a-flow",children:"Controller Interception Guide"})," for a full example."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Unexpected denials?"})," Log the signer meta to confirm the permissions/roles being evaluated."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Custom guards?"})," Double-check the resolver returns plain strings; nested arrays or objects will be ignored."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Mixed ecosystems?"})," You can use both permissions and roles in the same step; Guardrails requires that both pass according to their respective modes."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"related-configuration",children:"Related configuration"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"guardrails.permissions.view"})," and ",(0,r.jsx)(s.code,{children:"guardrails.permissions.sign"})," gate the built-in API routes."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"guardrails.signing.resolve_roles_using"})," supplies a custom resolver."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["For examples of defining signer rules, see the ",(0,r.jsx)(s.a,{href:"/guardrails/docs/usage-models",children:"Model Guarding Guide"})," and ",(0,r.jsx)(s.a,{href:"/guardrails/docs/usage-controllers",children:"Controller Interception Guide"}),"."]})]})}function h(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,s,i)=>{i.d(s,{R:()=>o,x:()=>a});var n=i(96540);const r={},l=n.createContext(r);function o(e){const s=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(l.Provider,{value:s},e.children)}}}]);