"use strict";(self.webpackChunkguardrails_docs=self.webpackChunkguardrails_docs||[]).push([[3468],{6235:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>d,default:()=>u,frontMatter:()=>l,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"testing-full","title":"testing-full","description":"title: Full Testing Guide","source":"@site/versioned_docs/version-0.3.0/testing-full.md","sourceDirName":".","slug":"/testing-full","permalink":"/guardrails/docs/testing-full","draft":false,"unlisted":false,"editUrl":"https://github.com/ovac/guardrails/edit/main/resources/docs/versioned_docs/version-0.3.0/testing-full.md","tags":[],"version":"0.3.0","frontMatter":{},"sidebar":"docs","previous":{"title":"permissions","permalink":"/guardrails/docs/permissions"},"next":{"title":"testing","permalink":"/guardrails/docs/testing"}}');var i=s(4848),r=s(8453);const l={},d="Full Testing Guide",o={},a=[{value:"Running the Suite",id:"running-the-suite",level:2},{value:"What\u2019s Covered",id:"whats-covered",level:2},{value:"Structure",id:"structure",level:2},{value:"Writing Your App Tests",id:"writing-your-app-tests",level:2},{value:"CI",id:"ci",level:2}];function c(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"title: Full Testing Guide\ndescription: Unit, feature, mock, and end-to-end testing with Testbench."}),"\n",(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"full-testing-guide",children:"Full Testing Guide"})}),"\n",(0,i.jsx)(t.p,{children:"Guardrails is tested with Pest + Orchestra Testbench using an in-memory sqlite database. This guide explains how to run the suite and how to test your app-specific flows."}),"\n",(0,i.jsx)(t.h2,{id:"running-the-suite",children:"Running the Suite"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"composer update\n./vendor/bin/pest --coverage\n"})}),"\n",(0,i.jsx)(t.h2,{id:"whats-covered",children:"What\u2019s Covered"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Unit tests: builder, signing policy, auth helper."}),"\n",(0,i.jsx)(t.li,{children:"Feature tests: route registration, capture via trait, approve via API, controller interceptor."}),"\n",(0,i.jsx)(t.li,{children:"Events: faked and asserted for capture and completion."}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"structure",children:"Structure"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Tests use a stub ",(0,i.jsx)(t.code,{children:"users"})," provider model and a ",(0,i.jsx)(t.code,{children:"posts"})," table."]}),"\n",(0,i.jsxs)(t.li,{children:["Guard is set to ",(0,i.jsx)(t.code,{children:"web"})," for simplicity in tests; the package uses your configured guard."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"writing-your-app-tests",children:"Writing Your App Tests"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Use in-memory sqlite or test DB; load Guardrails migrations and your own tables."}),"\n",(0,i.jsxs)(t.li,{children:["Create a model with the ",(0,i.jsx)(t.code,{children:"ActorGuarded"})," trait and declare guarded attributes."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"actingAs($user, config('guardrails.auth.guard'))"})," to test capture/approve flows."]}),"\n",(0,i.jsxs)(t.li,{children:["Event testing: ",(0,i.jsx)(t.code,{children:"Event::fake([...])"})," and ",(0,i.jsx)(t.code,{children:"Event::assertDispatched(...)"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"ci",children:"CI"}),"\n",(0,i.jsxs)(t.p,{children:["GitHub Actions workflow ",(0,i.jsx)(t.code,{children:"run-tests.yml"})," runs the suite across PHP 8.1\u20138.3 and uploads coverage to Codecov."]})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>l,x:()=>d});var n=s(6540);const i={},r=n.createContext(i);function l(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);