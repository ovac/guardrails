"use strict";(self.webpackChunkguardrails_docs=self.webpackChunkguardrails_docs||[]).push([[6633],{25701:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>a,contentTitle:()=>d,default:()=>u,frontMatter:()=>l,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"testing-full","title":"testing-full","description":"title: Full Testing Guide","source":"@site/docs/testing-full.md","sourceDirName":".","slug":"/testing-full","permalink":"/guardrails/docs/next/testing-full","draft":false,"unlisted":false,"editUrl":"https://github.com/ovac/guardrails/edit/main/resources/docs/docs/testing-full.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Testing & Local Development","permalink":"/guardrails/docs/next/testing"}}');var r=t(74848),i=t(28453);const l={},d="Full Testing Guide",a={},o=[{value:"Running the Suite",id:"running-the-suite",level:2},{value:"What\u2019s Covered",id:"whats-covered",level:2},{value:"Structure",id:"structure",level:2},{value:"Writing Your App Tests",id:"writing-your-app-tests",level:2},{value:"CI",id:"ci",level:2},{value:"Related Guides",id:"related-guides",level:2}];function c(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"title: Full Testing Guide\ndescription: Unit, feature, mock, and end-to-end testing with Testbench."}),"\n",(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"full-testing-guide",children:"Full Testing Guide"})}),"\n",(0,r.jsx)(s.p,{children:"Guardrails is tested with Pest + Orchestra Testbench using an in-memory sqlite database. This guide explains how to run the suite and how to test your app-specific flows."}),"\n",(0,r.jsx)(s.h2,{id:"running-the-suite",children:"Running the Suite"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"composer update\n./vendor/bin/pest --coverage\n"})}),"\n",(0,r.jsx)(s.h2,{id:"whats-covered",children:"What\u2019s Covered"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Unit tests: builder, signing policy, auth helper."}),"\n",(0,r.jsx)(s.li,{children:"Feature tests: route registration, capture via trait, approve via API, controller interceptor."}),"\n",(0,r.jsx)(s.li,{children:"Events: faked and asserted for capture and completion."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"structure",children:"Structure"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Tests use a stub ",(0,r.jsx)(s.code,{children:"users"})," provider model and a ",(0,r.jsx)(s.code,{children:"posts"})," table."]}),"\n",(0,r.jsxs)(s.li,{children:["Guard is set to ",(0,r.jsx)(s.code,{children:"web"})," for simplicity in tests; the package uses your configured guard."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"writing-your-app-tests",children:"Writing Your App Tests"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Use in-memory sqlite or test DB; load Guardrails migrations and your own tables."}),"\n",(0,r.jsxs)(s.li,{children:["Create a model with the ",(0,r.jsx)(s.code,{children:"Guardrail"})," trait and declare guarded attributes."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"actingAs($user, config('guardrails.auth.guard'))"})," to test capture/approve flows."]}),"\n",(0,r.jsxs)(s.li,{children:["Event testing: ",(0,r.jsx)(s.code,{children:"Event::fake([...])"})," and ",(0,r.jsx)(s.code,{children:"Event::assertDispatched(...)"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"ci",children:"CI"}),"\n",(0,r.jsxs)(s.p,{children:["GitHub Actions workflow ",(0,r.jsx)(s.code,{children:"run-tests.yml"})," runs the suite across PHP 8.1\u20138.3 and uploads coverage to Codecov."]}),"\n",(0,r.jsx)(s.h2,{id:"related-guides",children:"Related Guides"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/guardrails/docs/next/usage-models",children:"Model Guarding Guide"})," \u2014 Set up fixtures that mirror your production models."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/guardrails/docs/next/usage-controllers",children:"Controller Interception Guide"})," \u2014 Cover interceptor flows in feature tests."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/guardrails/docs/next/advanced",children:"Advanced Flows"})," \u2014 Know what behaviours to assert for dynamic policies."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/guardrails/docs/next/patterns",children:"Common Patterns"})," \u2014 Use sample flows as starting points for new specs."]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453:(e,s,t)=>{t.d(s,{R:()=>l,x:()=>d});var n=t(96540);const r={},i=n.createContext(r);function l(e){const s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);