"use strict";(self.webpackChunkguardrails_docs=self.webpackChunkguardrails_docs||[]).push([[822],{7303:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"database","title":"database","description":"title: Database & Migrations","source":"@site/docs/database.md","sourceDirName":".","slug":"/database","permalink":"/guardrails/docs/next/database","draft":false,"unlisted":false,"editUrl":"https://github.com/ovac/guardrails/edit/main/resources/docs/docs/database.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"custom-controllers","permalink":"/guardrails/docs/next/custom-controllers"},"next":{"title":"extending-models-and-migrations","permalink":"/guardrails/docs/next/extending-models-and-migrations"}}');var r=s(4848),d=s(8453);const c={},l="Database & Migrations",a={},t=[];function o(e){const n={code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"title: Database & Migrations\ndescription: Tables created by Guardrails and important columns."}),"\n",(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"database--migrations",children:"Database & Migrations"})}),"\n",(0,r.jsx)(n.p,{children:"Publish the migrations and run them:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'php artisan vendor:publish --provider="OVAC\\\\Guardrails\\\\GuardrailsServiceProvider" --tag=guardrails-migrations\nphp artisan migrate\n'})}),"\n",(0,r.jsx)(n.p,{children:"Tables"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"human_approval_requests"})}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"id"})," \u2014 Primary key"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"approvable_type"}),", ",(0,r.jsx)(n.code,{children:"approvable_id"})," \u2014 Morph target of the change"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"actor_id"})," \u2014 User who initiated the change (from your configured guard)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"state"})," \u2014 pending|approved|rejected (package uses ",(0,r.jsx)(n.code,{children:"pending"})," and ",(0,r.jsx)(n.code,{children:"approved"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"new_data"})," \u2014 JSON snapshot of proposed values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"original_data"})," \u2014 JSON snapshot of original values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"context"})," \u2014 JSON route/event metadata"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"meta"})," \u2014 JSON for future extensions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"created_at"}),", ",(0,r.jsx)(n.code,{children:"updated_at"})]}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"human_approval_steps"})}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"id"}),", ",(0,r.jsx)(n.code,{children:"request_id"})," \u2014 Belongs to an approval request"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"level"})," \u2014 Step order (1-based)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"name"})," \u2014 Display name of the step"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"threshold"})," \u2014 Minimum approvals required for this step"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"status"})," \u2014 pending|completed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"completed_at"})," \u2014 Timestamp when threshold met"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"meta"})," \u2014 JSON including ",(0,r.jsx)(n.code,{children:"signers"}),", ",(0,r.jsx)(n.code,{children:"include_initiator"}),", ",(0,r.jsx)(n.code,{children:"preapprove_initiator"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"created_at"}),", ",(0,r.jsx)(n.code,{children:"updated_at"})]}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"human_approval_signatures"})}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"id"}),", ",(0,r.jsx)(n.code,{children:"step_id"})," \u2014 Belongs to a step"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"staff_id"})," \u2014 Signer staff"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"decision"})," \u2014 approved|rejected|postponed (package uses ",(0,r.jsx)(n.code,{children:"approved"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"comment"})," \u2014 Optional signer comment"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"signed_at"})," \u2014 Timestamp of the decision"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"meta"})," \u2014 JSON for extensions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"created_at"}),", ",(0,r.jsx)(n.code,{children:"updated_at"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Relationships"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ApprovalRequest"})," hasMany ",(0,r.jsx)(n.code,{children:"ApprovalStep"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ApprovalStep"})," hasMany ",(0,r.jsx)(n.code,{children:"ApprovalSignature"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ApprovalSignature"})," belongsTo ",(0,r.jsx)(n.code,{children:"ApprovalStep"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ApprovalRequest"})," morphTo ",(0,r.jsx)(n.code,{children:"approvable"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>l});var i=s(6540);const r={},d=i.createContext(r);function c(e){const n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(d.Provider,{value:n},e.children)}}}]);